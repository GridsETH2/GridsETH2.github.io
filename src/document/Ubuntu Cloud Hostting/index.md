## Nextcloud

### การพัฒนาสภาพแวดล้อม

โปรดทำตามขั้นตอนในหน้านี้เพื่อตั้งค่าสภาพแวดล้อมการพัฒนาของคุณ

### ตั้งค่าเว็บเซิร์ฟเวอร์และฐานข้อมูล

ขั้นแรก ให้[ตั้งค่าเว็บเซิร์ฟเวอร์และฐานข้อมูลของคุณ (ubuntu 20.04)](./system_requirements.md)

รับแหล่งที่มา
มีสองวิธีในการรับแหล่งที่มาของ Nextcloud:

การใช้เวอร์ชันเสถียร

การใช้เวอร์ชันการพัฒนาจากGitHubซึ่งจะอธิบายด้านล่าง

ในการตรวจสอบแหล่งที่มาจากGitHubคุณจะต้องติดตั้ง Git (ดูการตั้งค่า Gitจากความช่วยเหลือ GitHub)

รวบรวมข้อมูลเกี่ยวกับการตั้งค่าเซิร์ฟเวอร์
ในการเริ่มต้น ที่เก็บ Git พื้นฐานจะต้องถูกโคลนลงในไดเร็กทอรีของเว็บเซิร์ฟเวอร์ ขึ้นอยู่กับการกระจายนี้จะเป็น

/var/www

/var/www/html

/srv/http

จากนั้นระบุผู้ใช้และกลุ่มที่เว็บเซิร์ฟเวอร์กำลังทำงาน และผู้ใช้ Apache และกลุ่มสำหรับคำสั่งchownจะเป็น

http

www-data

apache

wwwrun

เช็คโค้ด
คำสั่งต่อไปนี้ใช้/var/wwwเป็นไดเร็กทอรีของเว็บเซิร์ฟเวอร์ และwww-dataเป็นชื่อผู้ใช้และกลุ่ม

หลังจากการติดตั้งเครื่องมือการพัฒนาทำให้ไดเร็กทอรีสามารถเขียนได้ ดังนั้นคุณจึงติดตั้งโค้ดในฐานะผู้ใช้ทั่วไป และไม่ต้องการสิทธิ์รูท:

sudo chmod o+rw /var/www
จากนั้นติดตั้ง Nextcloud ที่รูทของไซต์ของคุณจาก Git:

git clone https://github.com/nextcloud/server.git /var/www/
cd /var/www
git submodule update --init
ถ้าคุณต้องการติดตั้ง Nextcloud ในโฟลเดอร์ย่อยแทน/ var / wwwกับ/ var / www / <โฟลเดอร์>

สร้างโฟลเดอร์ข้อมูล:

cd /var/www
mkdir data
ปรับสิทธิ์:

cd /var/www
sudo chown -R www-data:www-data config data apps
sudo chmod o-rw /var/www
สุดท้าย ให้รีสตาร์ทเว็บเซิร์ฟเวอร์ (อาจแตกต่างกันไปตามการแจกจ่ายของคุณ):

sudo systemctl restart httpd.service
หรือ:

sudo systemctl restart apache2.service
หรือ:

sudo /etc/init.d/apache2 restart
ตอนนี้เข้าถึงการติดตั้งที่http://localhost/ (หรือ URL ที่เกี่ยวข้อง) ในเว็บเบราว์เซอร์ของคุณเพื่อตั้งค่าอินสแตนซ์ของคุณ

ตรวจสอบแอพที่จัดส่งภายนอก
ขั้นตอนทางเลือกนี้จำเป็นอย่างยิ่งหากคุณต้องการทดสอบการอัปเกรด เนื่องจากต้องมีแอปต่อไปนี้ในระหว่างการอัปเกรด

ติดตั้งแอพตัวแสดง:

cd /var/www/apps
git clone https://github.com/nextcloud/viewer.git
ตรวจสอบให้แน่ใจว่าใช้เวอร์ชันที่เข้ากันได้กับเซิร์ฟเวอร์โดยตรวจสอบจากแท็กที่ตรงกัน คุณสามารถตรวจสอบappinfo/info.xmlแอพเพื่อดูว่าmin-versionฟิลด์นั้นเข้ากันได้กับเซิร์ฟเวอร์ปัจจุบันหรือไม่

เมื่ออัพเกรดเซิร์ฟเวอร์รหัสที่คุณอาจจำเป็นต้องปรับโค้ดแอปได้เป็นอย่างดีก่อนที่จะใช้occ upgrade

บันทึก

เช่นเดียวกับแอปทั้งหมดที่ระบุไว้alwaysEnabledในship.jsonแต่ส่วนใหญ่มีอยู่แล้วในที่เก็บเซิร์ฟเวอร์

เปิดใช้งานโหมดแก้ไขข้อบกพร่อง
บันทึก

อย่าเปิดใช้งานสิ่งนี้สำหรับการผลิต! สิ่งนี้สามารถสร้างปัญหาด้านความปลอดภัยและมีไว้สำหรับการดีบักและการพัฒนาเท่านั้น!

เพื่อปิดการใช้งาน JavaScript และ CSS แคชแก้จุดบกพร่องจะต้องมีการเปิดใช้งานโดยการตั้งค่าdebugไปtrueในconfig/config.php:

<?php
$CONFIG = array (
    'debug' => true,
    ... configuration goes here ...
);
อัปเดตรหัสให้ทันสมัยอยู่เสมอ
หากคุณมีที่เก็บโคลนมากกว่าหนึ่งที่เก็บ การดำเนินการแบบเดียวกันกับที่เก็บทั้งหมดอาจใช้เวลานาน เพื่อแก้ปัญหานี้ คุณสามารถใช้เทมเพลตคำสั่งต่อไปนี้:

find . -maxdepth <DEPTH> -type d -name .git -exec sh -c 'cd "{}"/../ && pwd && <GIT COMMAND>' \;
ดังนั้น เช่น ในการดึงการเปลี่ยนแปลงทั้งหมดในที่เก็บทั้งหมด คุณต้องใช้สิ่งนี้เท่านั้น:

find . -maxdepth 3 -type d -name .git -exec sh -c 'cd "{}"/../ && pwd && git pull --rebase' \;
หรือหากต้องการตัดกิ่งที่รวมกันทั้งหมด คุณจะต้องดำเนินการดังนี้:

find . -maxdepth 3 -type d -name .git -exec sh -c 'cd "{}"/../ && pwd && git remote prune origin' \;
มันจะง่ายยิ่งขึ้นไปอีกหากคุณสร้างนามแฝงจากคำสั่งเหล่านี้ ในกรณีที่คุณต้องการหลีกเลี่ยงการพิมพ์ซ้ำทุกครั้งที่คุณต้องการ